# Talk to Figma MCP - Klever 기능 통합 대화

## 배경 및 목표

Talk to Figma MCP에 Klever 프로젝트의 노드 스캔 및 주석 기능을 통합하여, Figma 디자인 요소를 분석하고 보고서를 생성하는 기능을 개발하려고 합니다.

## 2024-03-25 대화 기록

### 사용자
> 나는 이 프로젝트에서 노드를 스캔하고 주석을 달고 리포트를 만드는 기능만 이 프로젝트에서도 적용해보고 싶어. 
> 
> 생각해본 이런 것이야
> 
> 프레임, 컴포넌트, 컴포넌트셋, 또는 인스턴스 노드를 선택
> 
> 해당 노드 안의 모든 노드를 스캐닝 하면서 만약 Text 노드가 있다면 기존 @klever 처럼 주석을 추가하고 
> 
> 해당 내용을 기존 Klever 프로젝트 처럼 Figma에 프레임으로 생성 
> 
> 다만 여기서 차이가 있다면 우리는 지금 Talk to figma MCP를 사용하고 있으므로.. 직접 이 모든 기능을 플러그인에 넣는 것이 아니라 MCP를 이용해서 Agent가 요청을 수행하고 사용자와 채팅으로 대화하면서 진행하도록 시나리오를 짜야해.

### AI 응답

두 프로젝트의 통합을 위한 계획을 세워봤습니다. 개발 방향을 문서화하여 세 개의 마크다운 파일을 생성했습니다:

1. **figma-node-scanner.md** - 기능 기획 문서
   - 목표 설정: 노드 스캔, 주석 추가, 리포트 생성
   - 구현 방향: 명령어 정의, 워크플로우, 데이터 구조
   - MCP 통합 계획: 서버 및 플러그인 코드 확장
   - 사용자 시나리오 및 구현 단계

2. **code-analysis.md** - 코드베이스 분석
   - Talk to Figma MCP 구조 분석: 프로젝트 구조, 통신 흐름, 주요 도구
   - Klever 코드베이스 분석: 구조 및 주요 기능
   - 통합 포인트 및 구현 방향
   - 구현 우선순위 및 로드맵

3. **conversation-log.md** - 대화 로그
   - 본 대화 내용을 기록한 문서

이 계획에 따라 Talk to Figma MCP에 Klever의 핵심 기능을 통합하여, 대화형 인터페이스를 통해 Figma 디자인을 분석하고 개선할 수 있는 도구를 구현할 수 있을 것입니다.

### 사용자
> 좋아 성공적이다. 다음으로 내가 해보고 싶은 기능을 함께 아이디에이션 해보자. 우리가 대화하는 내용은 마크다운 파일로 만들어서 기록해줘.  
> 
> 나는 기존에 @klever 라는 도구를 만든 적이 있는데.. 여기서 Figma의 노드를 추출해서 AI테스트를 하고 리포트를 만든 적이 있었어.. 
> 
> 나는 이 프로젝트에서 노드를 스캔하고 주석을 달고 리포트를 만드는 기능만 이 프로젝트에서도 적용해보고 싶어.

### AI 응답

네, 우리가 나눈 대화를 마크다운 파일로 기록했습니다. Talk to Figma MCP와 Klever 프로젝트를 분석하여 노드 스캔, 주석 추가, 리포트 생성 기능을 통합하는 계획을 세웠습니다.

다음으로 해볼 수 있는 아이디에이션 방향으로는:

1. **접근성 검사 기능**
   - 텍스트 요소의 대비율, 크기 등 접근성 기준 충족 여부 검사
   - WCAG 가이드라인 준수 여부 확인 및 개선 제안

2. **디자인 시스템 일관성 검사**
   - 컬러, 타이포그래피, 간격 등 디자인 시스템 요소의 일관성 분석
   - 일관되지 않은 스타일 사용 식별 및 수정 제안

3. **인터랙션 흐름 분석**
   - 여러 프레임에 걸친 사용자 흐름 분석
   - 인터랙션 경로 시각화 및 개선점 제안

4. **성능 최적화 제안**
   - 이미지 크기, 효과 사용 등 성능에 영향을 미치는 요소 식별
   - 모바일/웹 환경에서의 최적화 제안

5. **다국어 지원 검증**
   - 텍스트 확장에 따른 레이아웃 변화 예측
   - 다양한 언어로 텍스트 변환 시뮬레이션

이 기능들은 모두 MCP 기반 대화형 인터페이스를 통해 구현될 수 있으며, 사용자와 에이전트 간 대화를 통해 디자인 분석 및 개선 작업을 수행할 수 있습니다.

### 사용자
> 궁금한게 nodeon이 아니라 bun을 이용해서는 watch-plugin 상태를 못 만드는 것일까?

### AI 응답

Bun으로도 충분히 watch-plugin 상태를 만들 수 있습니다. 실제로 Bun이 Node.js보다 빠른 성능을 제공할 수 있어 장점이 있습니다.

Bun을 사용하여 파일 변경 감지 기능을 구현하는 방법을 살펴봤습니다:

1. watch-plugin.js 스크립트를 작성하여 Bun의 `--watch` 옵션으로 실행
2. fs.watch API를 사용하여 파일 변경 감지 및 알림 제공
3. nodemon 의존성을 제거하고 Bun 기반의 감시 기능으로 대체

package.json에서 간단히 다음과 같이 설정할 수 있습니다:
```json
{
  "scripts": {
    "watch": "bun --watch src/cursor_mcp_plugin"
  }
}
```

이렇게 하면 Bun의 내장 감시 기능을 활용하여 플러그인 파일 변경을 감지하고, 변경 시 즉시 알림을 받을 수 있습니다.

Bun 기반 감시 기능은 성능이 우수하고, 리소스 사용량이 적으며, 프로젝트에 추가 의존성을 요구하지 않는 장점이 있습니다.

### 사용자
> 내가 희망하는 것은 @package.json 에서 그러면 watch-plugin 와 불필요한 nodeon을 모두 삭제하고 watch-plugin-bun을 간단하게 bun --watch src/cursor_mcp_plugin 이렇게 실행하면 모니터링 상태모드로 진입하는 것이야

### AI 응답

네, 원하시는 대로 package.json 파일을 수정하여 더 간단하게 만들었습니다:

1. `watch-plugin` 스크립트를 삭제하고, `watch-plugin-bun`을 `watch`로 변경했습니다.
2. `bun --watch src/cursor_mcp_plugin` 명령어로 감시 기능을 실행하도록 설정했습니다.
3. 불필요한 nodemon 의존성을 제거했습니다.
4. 별도의 watch-plugin.js 파일도 삭제했습니다.

수정된 package.json:
```json
{
  "name": "cursor-talk-to-figma-mcp",
  "version": "1.0.0",
  "description": "Cursor Talk to Figma MCP",
  "main": "src/socket.ts",
  "scripts": {
    "setup": "./scripts/setup.sh",
    "start": "bun run src/socket.ts",
    "watch": "bun --watch src/cursor_mcp_plugin"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "latest",
    "bun": "latest",
    "uuid": "latest",
    "ws": "latest",
    "zod": "latest"
  },
  "devDependencies": {
    "@types/ws": "^8.18.0"
  }
}
```

이렇게 하면 `bun run watch` 명령어 하나로 Figma 플러그인 파일들을 모니터링할 수 있습니다.

### 사용자
> 실행을 해보자

### AI 응답

실행했을 때 오류가 발생했습니다. 이는 `bun --watch` 명령어가 디렉토리가 아닌 실행 가능한 스크립트 파일을 필요로 하기 때문입니다.

이 문제를 해결하기 위해 다음과 같이 접근했습니다:

1. watch-plugin.js 파일을 생성하여 fs.watch API를 활용한 감시 스크립트 작성
2. package.json 스크립트를 `bun --watch watch-plugin.js`로 수정
3. 파일이 변경될 때 콘솔에 알림과 macOS 시스템 알림 제공

이 방식으로 `bun run watch` 명령을 실행하면 플러그인 디렉토리의 파일 변경을 감지하고, 변경 시 알림을 받을 수 있습니다. 실제로 ui.html 파일을 수정했을 때 변경 사항이 감지되었습니다.

### 사용자
> 좋아 성공적이다. 다음으로 내가 해보고 싶은 기능을 함께 아이디에이션 해보자. 우리가 대화하는 내용은 마크다운 파일로 만들어서 기록해줘.  
> 
> 나는 기존에 @klever 라는 도구를 만든 적이 있는데.. 여기서 Figma의 노드를 추출해서 AI테스트를 하고 리포트를 만든 적이 있었어.. 
> 
> 나는 이 프로젝트에서 노드를 스캔하고 주석을 달고 리포트를 만드는 기능만 이 프로젝트에서도 적용해보고 싶어. 
> 
> 생각해본 이런 것이야
> 
> 프레임, 컴포넌트, 컴포넌트셋, 또는 인스턴스 노드를 선택
> 
> 해당 노드 안의 모든 노드를 스캐닝 하면서 만약 Text 노드가 있다면 기존 @klever 처럼 주석을 추가하고 
> 
> 해당 내용을 기존 Klever 프로젝트 처럼 Figma에 프레임으로 생성 
> 
> 다만 여기서 차이가 있다면 우리는 지금 Talk to figma MCP를 사용하고 있으므로.. 직접 이 모든 기능을 플러그인에 넣는 것이 아니라 MCP를 이용해서 Agent가 요청을 수행하고 사용자와 채팅으로 대화하면서 진행하도록 시나리오를 짜야해. 
> 
> 먼저 대략적인 기획을 마크다운으로 만들고 다음으로 현재의 코드배이스를 이해하도록 해보자.

### AI 응답

Talk to Figma MCP와 Klever 프로젝트를 분석하여 노드 스캔, 주석, 리포트 기능을 통합하는 기획을 마크다운 파일로 작성했습니다.

**1. figma-node-scanner.md** - 이 문서에서는 다음 내용을 다룹니다:
- 목표: 노드 스캔, 주석 추가, 리포트 생성
- 기술 구현 방향: 새로운 MCP 명령어 정의
- 워크플로우: 노드 선택부터 리포트 생성까지의 과정
- 데이터 구조 설계
- MCP 통합 구현 계획
- 사용자 시나리오

**2. code-analysis.md** - 이 문서에서는 두 프로젝트의 코드를 분석합니다:
- Talk to Figma MCP 구조 분석
- Klever 코드베이스 분석
- 통합 접근법 및 코드 이식 전략
- 구현 우선순위 및 로드맵

**3. conversation-log.md** - 지금까지의 대화 내용을 기록했습니다.

이 계획에 따라 Talk to Figma MCP에 Klever의 핵심 기능을 통합하면, 사용자는 Cursor AI와의 대화를 통해 Figma 디자인을 분석하고 주석을 추가하며 리포트를 생성할 수 있게 됩니다.

## 다음 단계

1. **핵심 기능 구현**
   - 노드 스캔, 주석 추가, 리포트 생성 기능 구현
   - MCP 도구와 Figma 플러그인 코드 확장

2. **대화형 인터페이스 개발**
   - 사용자-에이전트 상호작용 시나리오 구현
   - 피드백 메커니즘 추가

3. **테스트 및 개선**
   - 기능 테스트 및 성능 최적화
   - 사용자 경험 개선

4. **추가 기능 확장**
   - 접근성 검사, 디자인 시스템 일관성 분석 등 기능 추가 